<!doctype html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <title>multi firebase</title>
        <link rel="stylesheet" type="text/css" href="style.css">

        <!-- <script src"jquery-3.1.1.min.js"></script>
        <script src"jquery-ui.min.js"></script> -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
        <script src="https://www.gstatic.com/firebasejs/3.6.0/firebase.js"></script>
        <script>
            function _assert(desc, v) {
                if (v) {
                    return;
                } else {
                    let caller = _assert.caller || 'Top level';
                    console.error('ASSERT in %s, %s is :', caller, desc, v);
                }
            }
        </script>
    </head>
    <body>
        <div>
            <button type="button" onclick="startVideo();">Start Video</button>
            <button type="button" onclick="stopVideo();">Stop Video</button>
            &nbsp;
            <button type="button" onclick="connect();">Connect</button>
            <button type="button" onclick="hangUp();">Hang Up</button>
            &nbsp;
            <a id="room_link" href="" target="_blank">Open another window (link to this room)</a>
            <a id="mail_link" href="" target="_blank">Mail link of this room</a>
        </div>
        <div>
            <video id="local_video" autoplay></video>
        </div>
        <div id="container"></div>
        <div id="text_content"></div>
        <div id="buttons" class="text-center">
            <button id="startRecBtn" class="btn btn-default">認識開始</button>
            <button id="stopRecBtn" class="btn btn-default">認識終了</button>
        </div>
    </body>
    <script src="webrtc.js"></script>
    <script>
        //音声認識モジュール
        $(document).ready(function () {
            var rec = new webkitSpeechRecognition();
            rec.continuous = true;
            rec.interimResults = false;
            rec.lang = 'ja-JP';

            var userSaid = function (str, s) {
                return str.indexOf(s) > -1;
            }

            function SayName(str) {
                var names = getName();
                var sayname;
                for (var i = 0; i < names.length; i++) {
                    if (str.indexOf(names[i]) > -1) {
                        sayname = names[i];
                    }
                }
                return sayname;
            }
            rec.onresult = function (e) {
                for (var i = e.resultIndex; i < e.results.length; ++i) {
                    if (e.results[i].isFinal) {
                        var str = e.results[i][0].transcript;
                        document.querySelector('#text_content').textContent = str;
                        console.log('Recognised: ' + str);
                        console.log(getName());
                        var sayname = SayName(str);
                        console.log(sayname);
                        if (userSaid(str, sayname)) {
                            var e = NamedElement[sayname];
                            switchbyname(e);
                            console.log(e);

                        }
                    }
                }
            }
            $("#startRecBtn").click(function () {
                rec.start();
            });
            $("#stopRecBtn").click(function () {
                rec.stop();
            });
        });

        // VideoElementと名前をオブジェクトとして管理
        var NamedElement = new Array();
        var username;
        document.addEventListener("dblclick", function (e) {
            var elem = e.target;
            if (elem.tagName.toLowerCase() === "video") {
                username = window.prompt("名前を入力してください");
            }
            setName(username, elem);
            console.log(NamedElement);
        }, true);

        function switchbyname(e) {
            $(e).css("width", "600px");
            $(e).css("height", "450px");
        }
        function getName() {
            var names = [];
            for (var name in NamedElement) {
                names.push(name);
            }
            return names;
        }

        function setName(name, element) {
            if (name === "" || name === null) {
                return
            } else {
                NamedElement[name] = element;
            }
        }
        // function SwitchByName(str) {     var names = [];     var sayname;     for (var name in NamedElement) {         names.push(name);     }     for (var i = 0; i < names.length; i++) {         if (str.indexOf(names[i]) > -1) {             sayname =
        // names[i];         }         NamedElement[sayname].className = "zoomed";     } }
    </script>
</html>
